# SIEMCLI
A lightweight and extensible Security Information and Event Management (SIEM) system.

## Index

- [Introduction](#introduction)
  - [Description](#description)
  - [Overview](#overview)
    - [Design Principles](#design-principles)
    - [Database Structure](#database-structure)
    - [JSON Output](#json-output)
- [Installation](#installation)
  - [Database Setup](#database-setup)
  - [Configuration](#configuration)
- [CLI Tools](#cli-tools)
  - [Siemparse](#siemparse)
  - [Siemquery](#siemquery)
  - [Siemtrigger](#siemtrigger)
  - [Siemmanage](#siemmanage)
- [License](#license)

## Introduction

### Description
SIEMCLI is a modular and efficient Security Information and Event Management (SIEM) system. It provides a suite of command-line tools to parse, query, manage, and analyze log events. The system is designed for simplicity, flexibility, and scalability, with core components that can be extended for various use cases.

### Overview

#### Design Principles
SIEMCLI follows the Unix philosophy of simplicity, modularity, and adaptability. Each tool serves a distinct purpose while working cohesively within the system. The design prioritizes ease of use, configurability, and extendibility.

#### Database Structure
SIEMCLI uses MariaDB as its database backend to store structured log data. Key database tables include:

- **Parsed Events**: Stores log entries parsed by `siemparse`. Each entry represents a single event extracted from monitored log files.
- **Helpers**: Contains dynamic attributes extracted from log events, such as IP addresses, usernames, or other relevant metadata.
- **Rules**: Defines conditions for triggering SIEM events. Each rule includes criteria, severity levels, and time-based thresholds.
- **SIEM Events**: Records alerts generated by the system based on defined rules, including metadata such as severity and event magnitude.

#### JSON Output
SIEMCLI supports exporting query results in JSON format, making it easier to integrate with data visualization tools or analyze logs programmatically.

## Installation

### Database Setup
1. Install MariaDB or a compatible SQL server.
2. Create a database and a user with appropriate permissions:

   ```sql
   CREATE DATABASE siemcli_db;
   CREATE USER 'siemcli_user'@'localhost' IDENTIFIED BY 'password';
   GRANT ALL PRIVILEGES ON siemcli_db.* TO 'siemcli_user'@'localhost';
   FLUSH PRIVILEGES;
   ```

3. Note the database credentials for configuring SIEMCLI.

### Configuration
The default configuration file is located at `/etc/siemcli/db.conf` (or `config/db.conf` within the repository). Update it with the database server address, credentials, and database name.

Additional configuration for table structures can be defined in `sections.conf`.

## CLI Tools

### Siemparse
`siemparse` parses log files or standard input and stores events in the database.

#### Usage

```bash
usage: siemparse [-h] [--version] [-c CONFIG] [-s SECTION] [-z TZONE] [file]

positional arguments:
  file        Specify the file to parse.

optional arguments:
  -h, --help  Show help message and exit.
  --version   Display version information.
  -c CONFIG   Specify the configuration file.
  -s SECTION  Specify the config section.
  -z TZONE    Set the UTC offset (e.g., '+0500').
```

#### Examples

```bash
siemparse /var/log/messages
siemparse -s auth /var/log/auth.log
```

### Siemquery
`siemquery` queries the database and supports exporting results in JSON format.

#### Usage

```bash
usage: siemquery [-h] [--version] [-c CONFIG] [-s SECTION] [--verbose]
                 [--silent] [--rule] [--json FILE] [--table TABLE]
                 [--last LAST] [--range START-FINISH] [--id ID]
                 [--shost HOST] [--sport PORT] [--dhost HOST]
                 [--dport PORT] [--process PROCESS] [--pid PID]
                 [--protocol PROTOCOL] [--grep PATTERN]
```

#### Examples

```bash
siemquery --last 6h --json events.json
siemquery --range 20230101000000-20230101235959 --grep fail
```

### Siemtrigger
`siemtrigger` evaluates rules and generates SIEM events based on database analysis.

#### Usage

```bash
usage: siemtrigger [-h] [--version] [-c CONFIG] [--table TABLE] [--oneshot]

optional arguments:
  -h, --help     Show help message and exit.
  --version      Display version information.
  -c CONFIG      Specify the configuration file.
  --table TABLE  Specify the rules table to evaluate.
  --oneshot      Run a single evaluation and exit.
```

#### Examples

```bash
siemtrigger --table RULESAuth
```

### Siemmanage
`siemmanage` is a utility for managing SIEM tables, importing/exporting rules, and clearing data.

#### Usage

```bash
usage: siemmanage [-h] [--version] [-c CONFIG] [--clear] [--force]
                  [--importrules FILE] [--exportrules FILE]
                  [--importhelpers FILE] [--exporthelpers FILE]
                  [--table TABLE]

optional arguments:
  -h, --help            Show help message and exit.
  --version             Display version information.
  -c CONFIG             Specify the configuration file.
  --clear               Delete the specified table.
  --force               Confirm deletion.
  --importrules FILE    Import rules from a JSON file.
  --exportrules FILE    Export rules to a JSON file.
  --importhelpers FILE  Import helpers from a JSON file.
  --exporthelpers FILE  Export helpers to a JSON file.
  --table TABLE         Specify the table to manage.
```

#### Examples

```bash
siemmanage --importhelpers config/helpers.json
siemmanage --exportrules rules.json --table RULESAuth
siemmanage --clear --force --table Auth
```

## License

This project is licensed under the MIT License. See the `LICENSE` file for more details.
